<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

<head>

<script src="/webjars/sockjs-client/sockjs.min.js"></script>
<script src="/webjars/stomp-websocket/stomp.min.js"></script>
<style>
	#all{
		width:400px;
		height:200px;
		overflow: auto;
		border:2px solid red;
	}
	#me{
		width:400px;
		height:200px;
		overflow: auto;
		border:2px solid blue;
	}
	#to{
		width:400px;
		height:200px;
		overflow: auto;
		border:2px solid green;
	}
</style>

<script th:inline="javascript">
	 /*<![CDATA[*/ 
	var stompClient = null;
	var id = [[${session.loginid.id}]];
	/* ]]> */
	// 서버소켓에 연결
	function connect() {
		var socket = new SockJS('/ws');
		stompClient = Stomp.over(socket);

		stompClient.connect({}, function(frame) { 
			setConnected(true);
			console.log('Connected: ' + frame);
			stompClient.subscribe('/send', function(msg) { 
				$("#all").append(
						"<h4>" + JSON.parse(msg.body).sendid +":"+
						JSON.parse(msg.body).content1
								+ "</h4>");
			});
			stompClient.subscribe('/send/'+id, function(msg) { 
				$("#me").append(
						"<h4>" + JSON.parse(msg.body).sendid +":"+
						JSON.parse(msg.body).content1+"<br><br>"+
						JSON.parse(msg.body).content2
								+ "</h4>");
			});
			stompClient.subscribe('/send/tomsg/'+id, function(msg) { 
				$("#to").append(
						"<h4>" + JSON.parse(msg.body).sendid +":"+
						JSON.parse(msg.body).content1
								+ "</h4>");
			});
			stompClient.subscribe('/send/serversend', function(msg) { 
				$("#servermsg1").text(JSON.parse(msg.body).content1);
				$("#servermsg2").text(JSON.parse(msg.body).content2);
			});
		});
	}
	
	// 서버소켓에 연결끊기
	function disconnect() {
		if (stompClient !== null) {
			stompClient.disconnect();
		}
		setConnected(false);
		console.log("Disconnected");
	}

	// connect&disconnect버턴 활성화/비활성화
	function setConnected(connected) {
		if (connected) {
			$("#status").text("Connected");
		} else {
			$("#status").text("Disconnected");
		}
		
	}

	// 서버에 메세지 요청 메서드
	function sendAll() {
		var msg = JSON.stringify({
			'sendid' : id,
			'content1' : $("#alltext").val()
		});
		stompClient.send("/receiveall", {}, msg);
	}
	function sendMe() {
		var msg = JSON.stringify({
			'sendid' : id,
			'content1' : $('#metext').val()
		});
		stompClient.send("/receiveme", {}, msg);
	}
	function sendTo() {
		var msg = JSON.stringify({
			'sendid' : id,
			'receiveid' : $('#target').val(),
			'content1' : $('#totext').val()
		});
		stompClient.send('/receivetomsg', {}, msg);
	}
	$(document).ready(function() {
		$("#connect").click(function() {
			connect();
		});
		$("#disconnect").click(function() {
			disconnect();
		});
		$("#sendall").click(function() {
			sendAll();
		});
		$("#sendme").click(function() {
			sendMe();
		});
		$("#sendto").click(function() {
			sendTo();
		});
	});
</script>
</head>





<!-- /websoket -->
<script>

function checkout(){
	$('#orderimple_form').attr({
		'method':'post',
		'action':'/cart/orderimple'
	})
	$('#orderimple_form').submit();
};


$(document).ready(function(){
	var totalPrice = $('#totalPrice').val();
	var finalPrice = 1*3000 + 1*totalPrice;
	$('#finalPrice').text(finalPrice+' 원');
});

</script>

<section class="py-8 overflow-hidden">

  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="card card-span mb-3 shadow-lg">
          <div class="card-body py-0">
            <div class="row justify-content-center">
               <div class="p-5">
              <h1 style= " font-family: 'Jua', sans-serif; "  class="card-title mt-xl-5 mb-4 text-center"><span class="text-primary"><i class="fas fa-hamburger me-2"></i>Order Page</span>&nbsp 주문페이지</h1>
               
                             
               <div class="row pt-2"><div class="col-lg-1"></div>                
                
				<form id="orderimple_form">
	                <!-- ======배달정보입력 div(좌측)====== -->
	                <div class="col-lg-6">
	             	 <div class="card">
			          <div class="p-1">
			          
			             <!-- 주문하기 Header -->
					      <div class="modal-header">
					      	<div class="ps-3">
					          <h4 style= "color: #ffa000; font-family: 'Jua', sans-serif; "  class="modal-title"><i class="fas fa-credit-card"></i>  &nbsp 주문하기</h4>					      	
					      	</div>
					      </div>
					
					      <!-- 주문하기 배달 정보 -->
					      <div class="modal-body">	
					      	<div class="p-3">						      						      	
						      	<h5 style= "color: #ffa000; font-family: 'Jua', sans-serif; "  class="pb-2">배달정보</h5>
	
								<h4 style= " font-family: 'Jua', sans-serif; "  th:text="${cust.addr}">th:text ADDR</h4>
								<h5 style= " font-family: 'Jua', sans-serif; "  th:text="${cust.addrd}">th:value= ADDRD"></h5><p></p>
								<hr>
								<input type="hidden" name="uid" th:value="${cust.id}">
								<input type="hidden" name="nick" th:value="${cust.nick}">
								<input type="hidden" name="addr" th:value="${cust.addr}">
								<input type="hidden" name="addrd" th:value="${cust.addrd}">
								<input id="" class="form-control input-box form-foodwagon-control" name="phon" placeholder="th:value= PHONE" th:value="${cust.phon}">													
					      	</div>			      		
				      	  </div>
				      	  <div class="modal-footer">
					         <div class="modal-body">							      						      	
						      	<h5 style= "color: #ffa000; font-family: 'Jua', sans-serif; "  class="pb-2">요청사항</h5>
								<h6 style= "font-family: 'Jua', sans-serif; " >가게사장님께</h6>
								<input id="" class="form-control input-box form-foodwagon-control" name="ask" placeholder="예) 당근 빼주세요. 김치 많이주세요.">
				      	    </div>	
					      </div>
					      
			          </div>												
			         </div>		         
	                </div>
				</form>
		        
		        <!-- =====주문상세 div (우측)===== -->                	               	
                 <div class="col-lg-4 pt-3">
		          <div class="p-1">
		          
		             <!-- 주문상세 Header -->
				      <div class="modal-header2">
				      	<div class="ps-3">
				          <h5 style= "color: #ffa000; font-family: 'Jua', sans-serif; "  class="modal-title"> 주문요약</h5>					      	
				      	</div>
				      </div>
				
				      <!-- 주문상세 음식정보 -->
				      <div class="modal-body">
				      	<h3 style= " font-family: 'Jua', sans-serif; "  th:text="${shop.name}">가게이름  th:text="${i.sname}"</h3>	
			             <table   width="100%" style="color:black;">
		                   <tbody>
	                         <tr>
                               <td   th:if="${cnt} == 0"><h6 style= " font-family: 'Jua', sans-serif; "  th:text="${mname}">메뉴명(th:text="${m.mname}")</h6></td>	                              
                               <td   th:unless="${cnt} == 0"><h6 style= " font-family: 'Jua', sans-serif; "  th:text="${mname}+' 외 '+${cnt}+'개'">메뉴명(th:text="${m.mname}")</h6></td>
                               <td style= " font-family: 'Jua', sans-serif; "  align="right">비고</td>
		                     </tr>
		                     <!-- 
		                     <tr >
                               <td>
                               	<ul>
                               	  <li>
                               	    <p1>기본:&nbsp</p1>
                               	    <p1>메뉴기본가격 ( th:text="${#numbers.formatInteger(m.mprice, 0, 'COMMA')+'원'}")</p1>
                               	  </li> 
                               	  <li>
                               	    <p1>추가옵션(가격):&nbsp</p1>
                               	    <p1> 추가옵션가격  th:each="opt: ${opt}" th:if="${opt.deid}==${m.deid}" 
                               	    th:text="${opt.opname}+'('+${opt.opprice}+'원)&nbsp&nbsp&nbsp&nbsp'"</p1>
                               	  </li>
                               	</ul>
                               </td>                           
		                     </tr>
		                     <tr >
                               <td><h1></h1></td>                           
		                     </tr>
		                      -->
		                   </tbody>
			             </table>
		      		
			      	  </div>
			      	  
			      	  <!-- 주문상세 최종가격 -->
			      	  <div class="modal-footer2">
						  <table width="100%" cellspacing="0">
							  <tbody>
							    <tr>
							      <td><h6 style= "color: #ffa000; font-family: 'Jua', sans-serif; " >총 주문금액</h6>   </td>
							      <td><h6 style= " font-family: 'Jua', sans-serif; "  align="right" th:text="${totalPrice}+' 원'" >th:text</h6>   </td>
							    </tr>
							    <tr>
							      <td><h6 style= "color: #ffa000; font-family: 'Jua', sans-serif; " >배달팁</h6>   </td>
							      <td  align="right" ><h6 style= " font-family: 'Jua', sans-serif; " >3000 원</h6>   </td>
							    </tr>								  
							  </tbody>
						  </table>
						  <table width="100%" cellspacing="0">
							  <tbody>
							    <tr>
							      <td><h5 style= "color: #ffa000; font-family: 'Jua', sans-serif; " >최종결제가격</h5></td>
							      	<input type="hidden" id="totalPrice" th:value="${totalPrice}">
							      <td><h5 style= " font-family: 'Jua', sans-serif; "  id="finalPrice" align="right"> </h5></td>
							    </tr>
							  </tbody>
						  </table>
			      	  </div>					      
			        </div>												        
                </div>        
                <div class="col-lg-1"></div>
                <div class="text-center p-5">
                 <button  style="width:300px; font-family: 'Jua', sans-serif;"class="btn btn-primary" onclick="checkout();">결제하기</button>                               
                </div> 
 				</div>		
 				
 				
 					    
			   </div>            
            </div>  
		  </div>
		</div>
	  </div>
	</div>
  </div>
  <!-- websocket body -->

  
<body>
	<H1 th:text="${session.loginid.id}">ID</H1>
	<H1 id="status">Status</H1>
	<H1 id="servermsg1">Server Msg1</H1>
	<H1 id="servermsg2">Server Msg2</H1>
	<button id="connect">Connect</button>
	<button id="disconnect">Disconnect</button>
	
	<h3>All</h3>
	<input type="text" id="alltext"><button id="sendall">Send</button>
	<div id="all"></div>
	
	<h3>Me</h3>
	<input type="text" id="metext"><button id="sendme">Send</button>
	<div id="me"></div>
	
	<h3>To</h3>
	<input type="text" id="target">
	<input type="text" id="totext"><button id="sendto">Send</button>
	<div id="to"></div>

</body>
<!-- /websoket body -->

</section>
